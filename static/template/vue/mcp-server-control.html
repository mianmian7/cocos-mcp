<div class="mcp-server-control">
  <div class="header-section">
    <h2>{{ i18n.mcp_server_control }}</h2>
    <div class="status-indicator" :class="{ 'running': serverInfo.isRunning, 'stopped': !serverInfo.isRunning }">
      {{ serverInfo.isRunning ? i18n.status_running : i18n.status_stopped }}
    </div>
  </div>

  <div class="server-config">
    <div class="config-grid">
      <div class="config-item">
        <label for="port">{{ i18n.port }}:</label>
        <ui-num-input
          id="port"
          v-model="config.port"
          :disabled="serverInfo.isRunning"
          :min="1000"
          :max="65535"
          placeholder="3000">
        </ui-num-input>
      </div>

      <div class="config-item">
        <label for="name">{{ i18n.name }}:</label>
        <ui-input
          id="name"
          v-model="config.name"
          :disabled="serverInfo.isRunning"
          placeholder="cocos-mcp-server">
        </ui-input>
      </div>

      <div class="config-item">
        <label for="version">{{ i18n.version }}:</label>
        <span class="version-display">{{ VERSION }}</span>
      </div>

      <div class="config-item auto-start-item">
        <ui-checkbox
          :value="config.autoStart"
          @change="onAutoStartChange">
        </ui-checkbox>
        <label for="autoStart">{{ i18n.auto_start }}</label>
        <span class="auto-start-hint">{{ i18n.auto_start_hint }}</span>
      </div>
    </div>
  </div>

  <div class="server-controls">
    <ui-button 
      class="start-button" 
      :class="{ green: !serverInfo.isRunning }"
      :disabled="serverInfo.isRunning || isLoading"
      @click="startServer">
      {{ isLoading && !serverInfo.isRunning ? i18n.starting : i18n.start_server }}
    </ui-button>
    
    <ui-button 
      class="stop-button"
      :class="{ red: serverInfo.isRunning }"
      :disabled="!serverInfo.isRunning || isLoading"
      @click="stopServer">
      {{ isLoading && serverInfo.isRunning ? i18n.stopping : i18n.stop_server }}
    </ui-button>
  </div>

  <div class="quick-copy-section">
    <span class="quick-copy-label">{{ i18n.copy_config }}:</span>
    <ui-button class="quick-copy-btn" :class="{ copied: copiedBtn === 'claude' }" @click="copyClaudeCode">{{ copiedBtn === 'claude' ? '✓ Copied' : 'Claude Code' }}</ui-button>
    <ui-button class="quick-copy-btn" :class="{ copied: copiedBtn === 'cursor' }" @click="copyCursorVscode">{{ copiedBtn === 'cursor' ? '✓ Copied' : 'Cursor / VS Code' }}</ui-button>
  </div>

  <div class="tools-config">
    <h3>{{ i18n.available_tools }}</h3>
    <div class="tools-grid">
      <!-- Core Tools -->
      <div class="tool-category">
        <h4>{{ i18n.core_tools }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.createNodes" 
            @change="onToolChange('createNodes', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.create_nodes }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.modifyNodes" 
            @change="onToolChange('modifyNodes', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.modify_nodes }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.queryNodes" 
            @change="onToolChange('queryNodes', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.query_nodes }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.queryComponents" 
            @change="onToolChange('queryComponents', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.query_components }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.modifyComponents" 
            @change="onToolChange('modifyComponents', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.modify_components }}</label>
        </div>
      </div>

      <!-- Scene & Asset Tools -->
      <div class="tool-category">
        <h4>{{ i18n.scene_assets }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.operateCurrentScene" 
            @change="onToolChange('operateCurrentScene', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.scene_operations }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.operatePrefabAssets" 
            @change="onToolChange('operatePrefabAssets', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.prefab_operations }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.operateAssets" 
            @change="onToolChange('operateAssets', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.asset_operations }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.nodeLinkedPrefabsOperations" 
            @change="onToolChange('nodeLinkedPrefabsOperations', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.linked_prefab_operations }}</label>
        </div>
      </div>

      <!-- Discovery Tools -->
      <div class="tool-category">
        <h4>{{ i18n.discovery }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.getAvailableComponentTypes" 
            @change="onToolChange('getAvailableComponentTypes', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.get_component_types }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.getAvailableAssetTypes" 
            @change="onToolChange('getAvailableAssetTypes', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.get_asset_types }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.getAssetsByType" 
            @change="onToolChange('getAssetsByType', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.get_assets_by_type }}</label>
        </div>
      </div>

      <!-- Generation & Project Tools -->
      <div class="tool-category">
        <h4>{{ i18n.generation_project }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.generateImageAsset" 
            @change="onToolChange('generateImageAsset', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.generate_image_assets }}</label>
        </div>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.operateProjectSettings" 
            @change="onToolChange('operateProjectSettings', $event)"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.project_settings }}</label>
        </div>
      </div>

      <!-- File System Tools (Security Sensitive) -->
      <div class="tool-category security-warning">
        <h4>{{ i18n.file_system_tools }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.operateScriptsAndText"
            @change="onOperateScriptsAndTextChange"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.advanced_file_operations }}</label>
          <div class="security-note">
            <small>{{ i18n.file_operations_warning }}</small>
          </div>
        </div>
      </div>

      <!-- Code Execution Tools (Security Sensitive) -->
      <div class="tool-category security-warning">
        <h4>{{ i18n.code_execution_tools }}</h4>
        <div class="tool-item">
          <ui-checkbox 
            :value="config.tools.executeSceneCode"
            @change="onExecuteSceneCodeChange"
            :disabled="serverInfo.isRunning">
          </ui-checkbox>
          <label>{{ i18n.execute_scene_code }}</label>
          <div class="security-note">
            <small>{{ i18n.code_execution_warning }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="server-info" v-if="serverInfo.isRunning">
    <h3>{{ i18n.server_information }}</h3>
    <div class="info-row">
      <strong>{{ i18n.url }}:</strong> http://localhost:{{ config.port }}/mcp
    </div>
    <div class="info-row">
      <strong>{{ i18n.name }}:</strong> {{ config.name }}
    </div>
    <div class="info-row">
      <strong>{{ i18n.version }}:</strong> {{ VERSION }}
    </div>
    <div class="info-row">
      <strong>{{ i18n.active_tools }}:</strong> {{ getActiveToolsCount() }} / {{ getTotalToolsCount() }}
    </div>
  </div>

</div>
