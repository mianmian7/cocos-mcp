---
alwaysApply: true
description: å¿«é€Ÿå‚è€ƒæŒ‡å—å’Œæœ€ä½³å®è·µæ€»ç»“
---

# å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…å’Œæ„å»º
```bash
npm install          # å®‰è£…ä¾èµ–
npm run build        # ç¼–è¯‘TypeScript
```

### å¯åŠ¨æ‰©å±•
1. åœ¨Cocos Creatorä¸­å¯ç”¨æ‰©å±•
2. æ‰“å¼€ `Panel -> cocos-mcp -> MCP Server Control Panel`
3. ç‚¹å‡»"Start"å¯åŠ¨MCPæœåŠ¡å™¨
4. AIåŠ©æ‰‹è¿æ¥åˆ° `http://localhost:3000/mcp`

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶ä½ç½®

### ä¸»è¦å…¥å£æ–‡ä»¶
- `source/main.ts` - æ‰©å±•ç”Ÿå‘½å‘¨æœŸå’Œæ–¹æ³•å®šä¹‰
- `source/mcp/server-manager.ts` - MCPæœåŠ¡å™¨ç®¡ç†å™¨
- `source/mcp/config.ts` - é…ç½®å®šä¹‰å’Œé»˜è®¤å€¼

### å·¥å…·æ–‡ä»¶
- `source/mcp/tools/create-nodes.ts` - èŠ‚ç‚¹åˆ›å»ºå·¥å…·
- `source/mcp/tools/modify-nodes.ts` - èŠ‚ç‚¹ä¿®æ”¹å·¥å…·
- `source/mcp/tools/generate-image-asset.ts` - AIå›¾åƒç”Ÿæˆå·¥å…·
- `source/mcp/tools/operate-assets.ts` - èµ„æºæ“ä½œå·¥å…·

### UIé¢æ¿
- `source/panels/default/` - MCPæœåŠ¡å™¨æ§åˆ¶é¢æ¿
- `source/panels/ai-config/` - AIé…ç½®é¢æ¿
- `source/panels/image-generator/` - å›¾åƒç”Ÿæˆå™¨é¢æ¿

## ğŸ› ï¸ å¸¸ç”¨å¼€å‘å‘½ä»¤

### APIè°ƒç”¨
```typescript
// æŸ¥è¯¢èŠ‚ç‚¹ä¿¡æ¯
const nodeInfo = await Editor.Message.request('scene', 'query-node', {
  uuid: nodeUuid
});

// åˆ›å»ºèŠ‚ç‚¹
const result = await Editor.Message.request('scene', 'create-node', {
  parent: parentUuid,
  name: 'New Node'
});

// è®¾ç½®èŠ‚ç‚¹å±æ€§
await Editor.Message.request('scene', 'set-property', {
  uuid: nodeUuid,
  path: 'position',
  dump: { value: { x: 0, y: 0, z: 0 }, type: 'cc.Vec3' }
});
```

### MCPå·¥å…·æ³¨å†Œ
```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { z } from "zod";

export function registerToolNameTool(server: McpServer): void {
  server.registerTool(
    "tool_name",
    {
      title: "å·¥å…·æ ‡é¢˜",
      description: "å·¥å…·æè¿°",
      inputSchema: {
        parameter: z.string().describe("å‚æ•°æè¿°")
      }
    },
    async (args) => {
      // å·¥å…·å®ç°
      return {
        content: [{
          type: "text",
          text: JSON.stringify(result)
        }]
      };
    }
  );
}
```

### UUIDå¤„ç†
```typescript
import { McpServerManager } from "../server-manager";

// ç¼–ç UUID (ç”¨äºè¾“å‡º)
const encodedUuid = McpServerManager.encodeUuid(rawUuid);

// è§£ç UUID (ç”¨äºAPIè°ƒç”¨)
const rawUuid = McpServerManager.decodeUuid(encodedUuid);
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```typescript
try {
  const result = await operation();
  return {
    content: [{
      type: "text",
      text: JSON.stringify(result)
    }]
  };
} catch (error) {
  return {
    content: [{
      type: "text",
      text: JSON.stringify({
        success: false,
        error: error instanceof Error ? error.message : String(error)
      })
    }]
  };
}
```

### 2. è¾“å…¥éªŒè¯
```typescript
inputSchema: {
  nodeUuid: z.string().describe("èŠ‚ç‚¹UUID"),
  position: z.object({
    x: z.number(),
    y: z.number(),
    z: z.number()
  }).optional().describe("èŠ‚ç‚¹ä½ç½®"),
  components: z.array(z.string()).default([]).describe("ç»„ä»¶ç±»å‹åˆ—è¡¨")
}
```

### 3. å¼‚æ­¥æ“ä½œ
```typescript
// æ‰¹é‡æ“ä½œ
const results = await Promise.all(
  nodes.map(node => processNode(node))
);

// é”™è¯¯å¤„ç†
const results = await Promise.allSettled(
  operations.map(op => executeOperation(op))
);
```

## ğŸ”§ å¸¸ç”¨é…ç½®

### é»˜è®¤æœåŠ¡å™¨é…ç½®
```typescript
{
  port: 3000,
  name: "cocos-mcp-server",
  version: "1.0.1",
  tools: {
    // æ ¸å¿ƒå·¥å…·é»˜è®¤å¯ç”¨
    createNodes: true,
    modifyNodes: true,
    queryNodes: true,
    // å®‰å…¨æ•æ„Ÿå·¥å…·é»˜è®¤ç¦ç”¨
    operateScriptsAndText: false,
    executeSceneCode: false
  }
}
```

### å›¾åƒç”Ÿæˆé…ç½®
```typescript
{
  enabled: true,
  providers: [
    {
      id: "local-sd",
      type: "stable-diffusion",
      config: {
        baseUrl: "http://localhost:7860",
        timeout: 30000
      }
    }
  ]
}
```

## ğŸ“Š è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```typescript
// å¼€å‘ç¯å¢ƒæ—¥å¿—
if (process.env.NODE_ENV === 'development') {
  console.log('è¯¦ç»†è°ƒè¯•ä¿¡æ¯:', { args, result });
}
```

### 2. æ€§èƒ½ç›‘æ§
```typescript
console.time('operation-name');
const result = await operation();
console.timeEnd('operation-name');
```

### 3. å†…å­˜ä½¿ç”¨æ£€æŸ¥
```typescript
const memUsage = process.memoryUsage();
console.log('Memory usage:', {
  rss: `${Math.round(memUsage.rss / 1024 / 1024)}MB`,
  heapUsed: `${Math.round(memUsage.heapUsed / 1024 / 1024)}MB`
});
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. å·¥å…·æƒé™
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·éœ€è¦è°¨æ…å¯ç”¨
- ä»£ç æ‰§è¡Œå·¥å…·é»˜è®¤ç¦ç”¨
- æ‰€æœ‰è¾“å…¥éƒ½éœ€è¦éªŒè¯

### 2. é…ç½®å®‰å…¨
- APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯éœ€è¦åŠ å¯†å­˜å‚¨
- å®šæœŸæ£€æŸ¥é…ç½®å®Œæ•´æ€§
- å¤‡ä»½é‡è¦é…ç½®

### 3. æ“ä½œç¡®è®¤
```typescript
// å¯¹äºå±é™©æ“ä½œï¼Œæ·»åŠ ç¡®è®¤æœºåˆ¶
if (await confirmDangerousOperation()) {
  await executeDangerousOperation();
}
```

## ğŸ“š ç›¸å…³èµ„æº

### MCPåè®®æ–‡æ¡£
- [Model Context Protocol è§„èŒƒ](https://spec.modelcontextprotocol.io/)
- [MCP TypeScript SDK](https://github.com/modelcontextprotocol/typescript-sdk)

### Cocos Creatoræ–‡æ¡£
- [æ‰©å±•å¼€å‘æŒ‡å—](https://docs.cocos.com/creator/manual/zh/extension/)
- [Editor API å‚è€ƒ](https://docs.cocos.com/creator/api/zh/)
- [åœºæ™¯æ“ä½œ API](https://docs.cocos.com/creator/api/zh/modules/scene.html)

### é¡¹ç›®èµ„æº
- [é¡¹ç›®README](../README.md) - è¯¦ç»†åŠŸèƒ½ä»‹ç»
- [å·¥å…·å®ç°ç¤ºä¾‹](../source/mcp/tools/) - å…·ä½“å·¥å…·å®ç°å‚è€ƒ
- [é…ç½®ç®¡ç†](../source/mcp/config.ts) - é…ç½®ç³»ç»Ÿå®ç°

## ğŸ‰ å¼€å‘å¿ƒå¾—

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•å°†AIèƒ½åŠ›ä¸æ¸¸æˆå¼€å‘å·¥å…·æ·±åº¦é›†æˆã€‚é€šè¿‡MCPåè®®ï¼ŒAIåŠ©æ‰‹å¯ä»¥ç›´æ¥ä¸Cocos Creatorç¼–è¾‘å™¨äº¤äº’ï¼Œå®ç°ï¼š

1. **æ™ºèƒ½åœºæ™¯æ„å»º** - AIå¯ä»¥ç†è§£åœºæ™¯ç»“æ„ï¼Œåˆ›å»ºå’Œç®¡ç†å¤æ‚çš„æ¸¸æˆå¯¹è±¡
2. **èµ„äº§ç”Ÿæˆ** - é›†æˆAIå›¾åƒç”Ÿæˆï¼Œè‡ªåŠ¨åˆ›å»ºæ¸¸æˆèµ„æº
3. **ä»£ç è¾…åŠ©** - æä¾›åœºæ™¯è„šæœ¬æ‰§è¡Œå’Œæ–‡ä»¶æ“ä½œèƒ½åŠ›
4. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿç¡®ä¿å¯é æ€§
5. **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„æ¶æ„ä¾¿äºæ‰©å±•å’Œç»´æŠ¤

å¼€å‘æ­¤ç±»å·¥å…·éœ€è¦å¹³è¡¡åŠŸèƒ½æ€§ã€æ˜“ç”¨æ€§å’Œå®‰å…¨æ€§ï¼Œæ˜¯AIåº”ç”¨ä¸ä¸“ä¸šè½¯ä»¶é›†æˆçš„ä¼˜ç§€èŒƒä¾‹ã€‚