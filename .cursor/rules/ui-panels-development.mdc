---
globs: source/panels/**/*.vue,source/panels/**/*.ts,source/panels/**/*.js
description: UIé¢æ¿å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
---

# UIé¢æ¿å¼€å‘æŒ‡å—

## ğŸ“ é¢æ¿æ–‡ä»¶ç»“æ„

æ¯ä¸ªé¢æ¿ç›®å½•åº”è¯¥åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
panels/panel-name/
â”œâ”€â”€ index.ts              # é¢æ¿å…¥å£æ–‡ä»¶
â”œâ”€â”€ panel.vue             # Vueç»„ä»¶ä¸»æ–‡ä»¶
â”œâ”€â”€ style.css             # æ ·å¼æ–‡ä»¶ (å¯é€‰)
â””â”€â”€ components/           # å­ç»„ä»¶ç›®å½• (å¯é€‰)
    â”œâ”€â”€ SubComponent.vue
    â””â”€â”€ AnotherComponent.vue
```

### é¢æ¿å…¥å£æ–‡ä»¶ (index.ts)
```typescript
import { createPanel } from '@cocos/creator-types';
import PanelComponent from './panel.vue';

export const panel: PanelExtension = {
  name: 'panel-name',
  component: PanelComponent,
  messages: {
    // æ¶ˆæ¯å¤„ç†æ–¹æ³•
    'method-name': async function(state, ...args) {
      // å¤„ç†æ¶ˆæ¯
      return result;
    }
  }
};
```

### Vueç»„ä»¶ç»“æ„
```vue
<template>
  <div class="panel-container">
    <!-- UIå†…å®¹ -->
  </div>
</template>

<script lang="ts">
import { defineComponent, ref, onMounted } from 'vue';

export default defineComponent({
  setup() {
    // å“åº”å¼æ•°æ®
    const serverStatus = ref('stopped');
    const config = ref({});

    // ç”Ÿå‘½å‘¨æœŸé’©å­
    onMounted(async () => {
      // åˆå§‹åŒ–é€»è¾‘
      await loadInitialData();
    });

    // æ–¹æ³•å®šä¹‰
    const startServer = async () => {
      try {
        const result = await Editor.Message.request('cocos-mcp', 'start-mcp-server', config.value);
        if (result.success) {
          serverStatus.value = 'running';
        }
      } catch (error) {
        console.error('å¯åŠ¨æœåŠ¡å™¨å¤±è´¥:', error);
      }
    };

    return {
      serverStatus,
      config,
      startServer
    };
  }
});
</script>

<style scoped>
/* ç»„ä»¶æ ·å¼ */
.panel-container {
  padding: 16px;
}
</style>
```

## ğŸ¨ UIç»„ä»¶è§„èŒƒ

### 1. æ ·å¼è§„èŒƒ
```css
/* ä½¿ç”¨CSSå˜é‡ä¿æŒä¸€è‡´æ€§ */
.panel-container {
  --primary-color: #007acc;
  --border-color: #e1e4e8;
  --text-color: #24292f;
  --background-color: #ffffff;
}

/* å“åº”å¼å¸ƒå±€ */
.panel-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
  padding: 8px 16px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--background-color);
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn:hover {
  background: #f6f8fa;
}

.btn.primary {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
```

### 2. å¸ƒå±€ç»„ä»¶
```vue
<!-- æ ‡å‡†é¢æ¿å¸ƒå±€ -->
<template>
  <ui-panel>
    <ui-panel-header>
      <ui-label>é¢æ¿æ ‡é¢˜</ui-label>
    </ui-panel-header>

    <ui-panel-body>
      <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
      <div class="panel-content">
        <!-- å·¥å…·æ  -->
        <div class="toolbar">
          <ui-button @click="startServer" :disabled="isRunning">
            å¯åŠ¨æœåŠ¡å™¨
          </ui-button>
          <ui-button @click="stopServer" :disabled="!isRunning">
            åœæ­¢æœåŠ¡å™¨
          </ui-button>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="config-section">
          <ui-label>æœåŠ¡å™¨é…ç½®</ui-label>
          <ui-input v-model="config.port" placeholder="ç«¯å£å·" />
        </div>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="status-section">
          <ui-label>çŠ¶æ€: {{ serverStatus }}</ui-label>
        </div>
      </div>
    </ui-panel-body>
  </ui-panel>
</template>
```

## ğŸ”„ æ¶ˆæ¯ç³»ç»Ÿé›†æˆ

### 1. å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹
```typescript
// æ–¹æ³•1: ä½¿ç”¨Editor.Message.request (å¼‚æ­¥ï¼Œæœ‰è¿”å›å€¼)
const result = await Editor.Message.request('cocos-mcp', 'start-mcp-server', {
  port: 3000
});

// æ–¹æ³•2: ä½¿ç”¨Editor.Message.send (åŒæ­¥ï¼Œæ— è¿”å›å€¼)
Editor.Message.send('cocos-mcp', 'update-config', config);
```

### 2. ç›‘å¬æ¥è‡ªä¸»è¿›ç¨‹çš„æ¶ˆæ¯
```typescript
// åœ¨Vueç»„ä»¶ä¸­ç›‘å¬æ¶ˆæ¯
import { defineComponent, onMounted, onUnmounted } from 'vue';

export default defineComponent({
  setup() {
    let messageHandler: ((event: any, ...args: any[]) => void) | null = null;

    onMounted(() => {
      // ç›‘å¬æœåŠ¡å™¨çŠ¶æ€å˜åŒ–
      messageHandler = (event: any, status: string) => {
        serverStatus.value = status;
      };

      // æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨
      Editor.Message.addBroadcastListener('mcp-server-status-changed', messageHandler);
    });

    onUnmounted(() => {
      // æ¸…ç†æ¶ˆæ¯ç›‘å¬å™¨
      if (messageHandler) {
        Editor.Message.removeBroadcastListener('mcp-server-status-changed', messageHandler);
      }
    });

    return {
      // ...
    };
  }
});
```

## ğŸ“Š çŠ¶æ€ç®¡ç†

### 1. å“åº”å¼çŠ¶æ€
```typescript
import { ref, reactive } from 'vue';

export default defineComponent({
  setup() {
    // ç®€å•çŠ¶æ€
    const serverStatus = ref<'stopped' | 'starting' | 'running' | 'error'>('stopped');

    // å¤æ‚çŠ¶æ€å¯¹è±¡
    const config = reactive({
      port: 3000,
      name: 'cocos-mcp-server',
      version: '1.0.0',
      tools: {
        createNodes: true,
        modifyNodes: true,
        // ...
      }
    });

    // è®¡ç®—å±æ€§
    const isRunning = computed(() => serverStatus.value === 'running');
    const enabledToolsCount = computed(() =>
      Object.values(config.tools).filter(Boolean).length
    );
  }
});
```

### 2. çŠ¶æ€æŒä¹…åŒ–
```typescript
// ä½¿ç”¨localStorageæŒä¹…åŒ–çŠ¶æ€
const STORAGE_KEY = 'mcp-panel-config';

const loadConfig = () => {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    return saved ? JSON.parse(saved) : {};
  } catch (error) {
    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
    return {};
  }
};

const saveConfig = (config: any) => {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
  } catch (error) {
    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
  }
};

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
export default defineComponent({
  setup() {
    const config = reactive({ ...loadConfig() });

    // ç›‘å¬é…ç½®å˜åŒ–å¹¶ä¿å­˜
    watch(config, (newConfig) => {
      saveConfig(newConfig);
    }, { deep: true });
  }
});
```

## ğŸ¯ è¡¨å•å¤„ç†

### 1. è¡¨å•éªŒè¯
```vue
<template>
  <form @submit.prevent="handleSubmit">
    <ui-input
      v-model="form.port"
      :error="errors.port"
      placeholder="ç«¯å£å· (3000-9999)"
    />
    <ui-button type="submit" :disabled="!isFormValid">
      ä¿å­˜é…ç½®
    </ui-button>
  </form>
</template>

<script lang="ts">
import { defineComponent, ref, computed } from 'vue';

export default defineComponent({
  setup() {
    const form = ref({
      port: 3000
    });

    const errors = ref<Record<string, string>>({});

    const validateForm = () => {
      errors.value = {};

      if (!form.value.port || form.value.port < 3000 || form.value.port > 9999) {
        errors.value.port = 'ç«¯å£å·å¿…é¡»åœ¨3000-9999ä¹‹é—´';
      }
    };

    const isFormValid = computed(() => Object.keys(errors.value).length === 0);

    const handleSubmit = async () => {
      validateForm();

      if (!isFormValid.value) return;

      try {
        await saveConfig(form.value);
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      } catch (error) {
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
      }
    };

    return {
      form,
      errors,
      isFormValid,
      handleSubmit
    };
  }
});
</script>
```

## ğŸ”„ å¼‚æ­¥æ“ä½œå¤„ç†

### 1. LoadingçŠ¶æ€
```typescript
const startServer = async () => {
  loading.value = true;
  error.value = null;

  try {
    const result = await Editor.Message.request('cocos-mcp', 'start-mcp-server', config.value);

    if (result.success) {
      serverStatus.value = 'running';
    } else {
      throw new Error(result.message);
    }
  } catch (err) {
    error.value = err instanceof Error ? err.message : String(err);
    serverStatus.value = 'error';
  } finally {
    loading.value = false;
  }
};
```

### 2. é‡è¯•æœºåˆ¶
```typescript
const retryOperation = async (operation: () => Promise<any>, maxRetries = 3) => {
  let lastError: Error;

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await operation();
    } catch (error) {
      lastError = error instanceof Error ? error : new Error(String(error));

      if (i < maxRetries - 1) {
        // ç­‰å¾…åé‡è¯•
        await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
      }
    }
  }

  throw lastError;
};
```

## ğŸ“± å“åº”å¼è®¾è®¡

### 1. åª’ä½“æŸ¥è¯¢
```css
/* æ¡Œé¢ç«¯å¸ƒå±€ */
@media (min-width: 768px) {
  .panel-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
}

/* ç§»åŠ¨ç«¯å¸ƒå±€ */
@media (max-width: 767px) {
  .panel-content {
    padding: 12px;
  }

  .toolbar {
    flex-direction: column;
    gap: 8px;
  }
}
```

### 2. åŠ¨æ€ç»„ä»¶
```vue
<template>
  <div class="panel-container">
    <!-- æ¡Œé¢ç«¯æ˜¾ç¤ºè¡¨æ ¼ -->
    <ui-table v-if="isDesktop" :data="data" />

    <!-- ç§»åŠ¨ç«¯æ˜¾ç¤ºå¡ç‰‡ -->
    <div v-else class="card-list">
      <ui-card v-for="item in data" :key="item.id">
        {{ item.name }}
      </ui-card>
    </div>
  </div>
</template>

<script lang="ts">
import { defineComponent, ref, computed } from 'vue';

export default defineComponent({
  setup() {
    // æ£€æµ‹å±å¹•å°ºå¯¸
    const screenWidth = ref(window.innerWidth);

    const isDesktop = computed(() => screenWidth.value >= 768);

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    const handleResize = () => {
      screenWidth.value = window.innerWidth;
    };

    onMounted(() => {
      window.addEventListener('resize', handleResize);
    });

    onUnmounted(() => {
      window.removeEventListener('resize', handleResize);
    });

    return {
      isDesktop
    };
  }
});
</script>
```